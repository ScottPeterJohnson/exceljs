{"version":3,"sources":["../../../../../lib/xlsx/xform/core/core-xform.js"],"names":["utils","require","XmlStream","BaseXform","DateXform","StringXform","CoreXform","module","exports","map","tag","ns","format","DateFormat","attrs","DateAttrs","dt","toISOString","replace","CORE_PROPERTY_ATTRIBUTES","inherits","render","xmlStream","model","openXml","StdDocAttributes","openNode","creator","title","subject","description","identifier","language","keywords","category","lastModifiedBy","lastPrinted","revision","version","contentStatus","created","modified","closeNode","parseOpen","node","parser","name","Error","JSON","stringify","parseText","text","parseClose","undefined"],"mappings":"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","file":"core-xform.js","sourcesContent":["/**\n * Copyright (c) 2016 Guyon Roche\n * LICENCE: MIT - please refer to LICENCE file included with this module\n * or https://github.com/guyonroche/exceljs/blob/master/LICENSE\n */\n\n'use strict';\n\nvar utils = require('../../../utils/utils');\nvar XmlStream = require('../../../utils/xml-stream');\nvar BaseXform = require('../base-xform');\nvar DateXform = require('../simple/date-xform');\nvar StringXform = require('../simple/string-xform');\n\nvar CoreXform = module.exports = function() {\n  this.map = {\n    'creator': new StringXform({tag: 'creator', ns: 'dc'}),\n    'title': new StringXform({tag: 'title', ns: 'dc'}),\n    'subject': new StringXform({tag: 'subject', ns: 'dc'}),\n    'description': new StringXform({tag: 'description', ns: 'dc'}),\n    'identifier': new StringXform({tag: 'identifier', ns: 'dc'}),\n    'language': new StringXform({tag: 'language', ns: 'dc'}),\n    'keywords': new StringXform({tag: 'keywords', ns: 'cp'}),\n    'category': new StringXform({tag: 'category', ns: 'cp'}),\n    'lastModifiedBy': new StringXform({tag: 'lastModifiedBy', ns: 'cp'}),\n    'lastPrinted': new DateXform({tag: 'lastPrinted', ns: 'cp', format: CoreXform.DateFormat}),\n    'revision': new DateXform({tag: 'revision', ns: 'cp'}),\n    'version': new StringXform({tag: 'version', ns: 'cp'}),\n    'contentStatus': new StringXform({tag: 'contentStatus', ns: 'cp'}),\n    'created': new DateXform({tag: 'created', ns: 'dcterms', attrs: CoreXform.DateAttrs, format: CoreXform.DateFormat}),\n    'modified': new DateXform({tag: 'modified', ns: 'dcterms', attrs: CoreXform.DateAttrs, format: CoreXform.DateFormat})\n  };\n};\n\nCoreXform.DateFormat = function(dt) {\n  return dt.toISOString().replace(/[.]\\d{3}/, '');\n};\nCoreXform.DateAttrs = {'xsi:type': 'dcterms:W3CDTF'};\n\nCoreXform.CORE_PROPERTY_ATTRIBUTES = {\n  'xmlns:cp': 'http://schemas.openxmlformats.org/package/2006/metadata/core-properties',\n  'xmlns:dc': 'http://purl.org/dc/elements/1.1/',\n  'xmlns:dcterms': 'http://purl.org/dc/terms/',\n  'xmlns:dcmitype': 'http://purl.org/dc/dcmitype/',\n  'xmlns:xsi': 'http://www.w3.org/2001/XMLSchema-instance'\n};\n\nutils.inherits(CoreXform, BaseXform, {\n  render: function(xmlStream, model) {\n    xmlStream.openXml(XmlStream.StdDocAttributes);\n\n    xmlStream.openNode('cp:coreProperties', CoreXform.CORE_PROPERTY_ATTRIBUTES);\n\n    this.map['creator'].render(xmlStream, model.creator);\n    this.map['title'].render(xmlStream, model.title);\n    this.map['subject'].render(xmlStream, model.subject);\n    this.map['description'].render(xmlStream, model.description);\n    this.map['identifier'].render(xmlStream, model.identifier);\n    this.map['language'].render(xmlStream, model.language);\n    this.map['keywords'].render(xmlStream, model.keywords);\n    this.map['category'].render(xmlStream, model.category);\n    this.map['lastModifiedBy'].render(xmlStream, model.lastModifiedBy);\n    this.map['lastPrinted'].render(xmlStream, model.lastPrinted);\n    this.map['revision'].render(xmlStream, model.revision);\n    this.map['version'].render(xmlStream, model.version);\n    this.map['contentStatus'].render(xmlStream, model.contentStatus);\n    this.map['created'].render(xmlStream, model.created);\n    this.map['modified'].render(xmlStream, model.modified);\n\n    xmlStream.closeNode();\n  },\n\n  parseOpen: function(node) {\n    if (this.parser) {\n      this.parser.parseOpen(node);\n      return true;\n    }\n    switch (node.name) {\n      case 'coreProperties':\n        return true;\n      default:\n        this.parser = this.map[node.name];\n        if (this.parser) {\n          this.parser.parseOpen(node);\n          return true;\n        }\n        throw new Error('Unexpected xml node in parseOpen: ' + JSON.stringify(node));\n    }\n  },\n  parseText: function(text) {\n    if (this.parser) {\n      this.parser.parseText(text);\n    }\n  },\n  parseClose: function(name) {\n    if (this.parser) {\n      if (!this.parser.parseClose(name)) {\n        this.parser = undefined;\n      }\n      return true;\n    }\n    switch (name) {\n      case 'coreProperties':\n        this.model = {\n          creator: this.map['creator'].model,\n          title: this.map['title'].model,\n          subject: this.map['subject'].model,\n          description: this.map['description'].model,\n          identifier: this.map['identifier'].model,\n          language: this.map['language'].model,\n          keywords: this.map['keywords'].model,\n          category: this.map['category'].model,\n          lastModifiedBy: this.map['lastModifiedBy'].model,\n          lastPrinted: this.map['lastPrinted'].model,\n          revision: this.map['revision'].model,\n          contentStatus: this.map['contentStatus'].model,\n          created: this.map['created'].model,\n          modified: this.map['modified'].model\n        };\n        return false;\n      default:\n        throw new Error('Unexpected xml node in parseClose: ' + name);\n    }\n  }\n});\n"]}